# Secret Detection Rules
# Detects hardcoded credentials, API keys, and other secrets

name: Secret Detection
version: "1.0.0"
description: Rules for detecting hardcoded secrets and credentials in code

rules:
  # Cloud Provider Keys
  - id: SECRET-001
    name: AWS Access Key
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: 'AKIA[0-9A-Z]{16}'
    message: AWS Access Key ID detected
    fix: Remove the key, rotate it, and use IAM roles or environment variables
    category: secrets

  - id: SECRET-002
    name: AWS Secret Key
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: '(?i)aws_secret_access_key\s*=\s*[''"][A-Za-z0-9/+=]{40}[''"]'
    message: AWS Secret Access Key detected
    fix: Rotate immediately; use IAM roles or AWS Secrets Manager
    category: secrets

  - id: SECRET-003
    name: Google Cloud API Key
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: 'AIza[0-9A-Za-z_-]{35}'
    message: Google Cloud API Key detected
    fix: Rotate the key and use service account credentials
    category: secrets

  - id: SECRET-004
    name: Azure Storage Key
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: '(?i)AccountKey\s*=\s*[A-Za-z0-9+/=]{88}'
    message: Azure Storage Account Key detected
    fix: Rotate the key and use Azure Key Vault or managed identities
    category: secrets

  # Version Control Tokens
  - id: SECRET-005
    name: GitHub Token
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: 'gh[pousr]_[0-9a-zA-Z]{36}'
    message: GitHub token detected
    fix: Revoke the token and use environment variables
    category: secrets

  - id: SECRET-006
    name: GitHub Fine-grained PAT
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: 'github_pat_[a-zA-Z0-9_]{22,}'
    message: GitHub fine-grained personal access token detected
    fix: Revoke and regenerate; store in environment variable
    category: secrets

  - id: SECRET-007
    name: GitLab Token
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: 'glpat-[0-9a-zA-Z_-]{20,}'
    message: GitLab personal access token detected
    fix: Revoke and rotate the token
    category: secrets

  # API Keys
  - id: SECRET-008
    name: Hardcoded API Key
    severity: high
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: '(?i)api_?key\s*=\s*[''"][a-zA-Z0-9_-]{20,}[''"]'
    message: Hardcoded API key detected
    fix: Move API keys to environment variables or secrets manager
    category: secrets

  - id: SECRET-009
    name: Hardcoded Secret Token
    severity: high
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: '(?i)(?:secret|auth)_?(?:key|token)\s*=\s*[''"][a-zA-Z0-9_-]{20,}[''"]'
    message: Hardcoded secret token detected
    fix: Move secrets to environment variables or secrets manager
    category: secrets

  # Payment Platforms
  - id: SECRET-010
    name: Stripe Secret Key
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: 'rk_skey_[a-zA-Z0-9]{24,}'
    message: Stripe live secret key detected
    fix: Revoke and rotate; use environment variables
    category: secrets

  - id: SECRET-011
    name: Stripe Restricted Key
    severity: high
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: 'rk_live_[a-zA-Z0-9]{24,}'
    message: Stripe restricted key detected
    fix: Rotate the key; use environment variables
    category: secrets

  # Communication
  - id: SECRET-012
    name: Slack Token
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: 'xox[baprs]-[0-9]{10,13}-[0-9]{10,13}[a-zA-Z0-9-]*'
    message: Slack token detected
    fix: Revoke and rotate the token; use environment variables
    category: secrets

  - id: SECRET-013
    name: SendGrid API Key
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: 'SG\.[a-zA-Z0-9_-]{22}\.[a-zA-Z0-9_-]{43}'
    message: SendGrid API key detected
    fix: Revoke and rotate; use environment variables
    category: secrets

  # Private Keys
  - id: SECRET-014
    name: Private Key in Source
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: '-----BEGIN (?:RSA |EC |DSA |OPENSSH )?PRIVATE KEY-----'
    message: Private key embedded in source code
    fix: Remove from source; load private keys from secure file storage or KMS
    category: secrets

  # Database Connection Strings
  - id: SECRET-015
    name: Database Connection String with Credentials
    severity: critical
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: '(?i)(?:mongodb|postgres|mysql|redis)://[^@\s]+:[^@\s]+@'
    message: Database connection string with embedded credentials
    fix: Use environment variables for connection strings; separate credentials from URIs
    category: secrets

  # JWT / Bearer Tokens
  - id: SECRET-016
    name: JWT Token in Source
    severity: high
    cwe: "CWE-798"
    owasp: "A07:2021"
    languages: []
    pattern: 'eyJ[a-zA-Z0-9_-]{10,}\.[a-zA-Z0-9_-]{10,}\.[a-zA-Z0-9_-]{10,}'
    message: JWT token hardcoded in source code
    fix: Never hardcode JWTs; generate dynamically and store securely
    category: secrets

  # Generic Passwords
  - id: SECRET-017
    name: Hardcoded Password Variable
    severity: high
    cwe: "CWE-798"
    languages: []
    pattern: '(?i)(?:db_?password|mysql_?pass|pg_?password|redis_?password)\s*=\s*[''"][^''"]+[''"]'
    message: Database password hardcoded in variable
    fix: Use environment variables or a secrets manager
    category: secrets

  # Twilio
  - id: SECRET-018
    name: Twilio Account SID / Auth Token
    severity: high
    cwe: "CWE-798"
    languages: []
    pattern: '(?:AC[a-f0-9]{32}|SK[a-f0-9]{32})'
    message: Twilio credential detected
    fix: Use environment variables for Twilio credentials
    category: secrets
